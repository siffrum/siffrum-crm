<div class="row py-lg-2">
    <div class="col-lg-12 col-md-12 col-sm-12 col-12 pb-2">
        <button class="btn coinButton" (click)="openSqlQueryModal(0,'')">
            Add Query &#43;
        </button>
    </div>
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-12 tableFixHead">
            <!-- This commit adds the SQL report table to the component's HTML template.
The table displays the report name, query, and action buttons for editing, deleting, and previewing queries.
@Developer Musaib" -->
            <table class="table mb-0">

                <thead>
                    <tr>
                        <th>Report Name</th>
                        <th>Query</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of viewModel.sqlReportMasterList">
                        <td>{{item.reportName}}</td>
                        <td class="text-danger query">{{item.sqlQuery}}</td>
                        <td>
                            <i class="bi bi-pencil-square smallIcon ms-0" (click)="openSqlQueryModal( item.id,'')"
                                (mouseenter)="viewModel.showTooltip = true" (mouseleave)="viewModel.showTooltip = false"
                                [attr.title]="'Edit'" [attr.data-placement]="'left'"
                                [ngClass]="{ 'tooltip-show': viewModel.showTooltip }">
                            </i>
                            <i class=" bi bi-trash smallIcon" (click)="deleteSqlQueryById(item.id)"
                                (mouseenter)="viewModel.showTooltip = true" (mouseleave)="viewModel.showTooltip = false"
                                [attr.title]="'Delete'" [attr.data-placement]="'left'"
                                [ngClass]="{ 'tooltip-show': viewModel.showTooltip }"></i>
                            <i class="bi bi-eye-fill smallIcon" size="small"
                                (click)="openSqlQueryModal(0,item.sqlQuery)" (mouseenter)="viewModel.showTooltip = true"
                                (mouseleave)="viewModel.showTooltip = false" [attr.title]="'PreView'"
                                [attr.data-placement]="'left'"
                                [ngClass]="{ 'tooltip-show': viewModel.showTooltip }"></i>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- This commit adds the SQL Query modal to the component's HTML template. The modal is used for adding new SQL queries, editing existing queries, and previewing query results.
     It includes form fields for report name and query, and buttons for saving and updating queries. and Displays Query Preview Table -->
    <div class="modal expandIn" tabindex="-1" role="dialog" [ngStyle]="{'display':viewModel.displayStyle}">
        <div class="modal-dialog" role="document">
            <div class="modal-content" *ngIf="viewModel.form">
                <div class="modal-header">
                    <div class="col-lg-11 col-md-11 col-sm-11 col-11">
                        <h5> Add SqlQuery </h5>
                    </div>

                    <button type="button" class="btn-close" (click)="closePopup(sqlQueryForm)"></button>
                </div>
                <form #sqlQueryForm="ngForm">

                    <div class="modal-body">
                        <div class="row">

                            <div class="col-lg-5 col-md-6 col-sm-12 col-12 p-lg-2 p-md-2 p-sm-2 p-2">
                                <label> Report Name <span class="text-danger fs-5">*</span> </label>
                            </div>

                            <div class="col-lg-7 col-md-6 col-sm-12 col-12 p-lg-2 p-md-2 p-sm-2 p-2">
                                <input type="text" class="form-control" required name="reportName"
                                    pattern="^[A-Za-z][A-Za-z0-9\s]*$"
                                    [(ngModel)]="viewModel.sqlReportMaster.reportName" minlength="3" maxlength="20"
                                    placeholder="Enter Report Name" #reportName="ngModel">
                                <div *ngFor="let validation of viewModel.validations.reportName">
                                    <div *ngIf="(reportName.touched || viewModel.formSubmitted) && reportName.hasError(validation.type)"
                                        class="text-danger validationMsg">
                                        {{validation.message}}
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-5 col-md-6 col-sm-12 col-12 p-lg-2 p-md-2 p-sm-2 p-2">
                                <label>Query<span class="text-danger fs-5">*</span> </label>
                            </div>

                            <div class="col-lg-7 col-md-6 col-sm-12 col-12 p-lg-2 p-md-2 p-sm-2 p-2">
                                <textarea class="form-control query" required name="sQLQuery"
                                    [(ngModel)]="viewModel.sqlReportMaster.sqlQuery" placeholder="Enter Query name"
                                    #sQLQuery="ngModel"></textarea>
                                <div *ngFor="let validation of viewModel.validations.sQLQuery">
                                    <div *ngIf="(sQLQuery.touched || viewModel.formSubmitted) && sQLQuery.hasError(validation.type)"
                                        class="text-danger validationMsg">
                                        {{validation.message}}
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-end" *ngIf="viewModel.addMode">
                                    <button class="btn coinButton" (click)="addSqlQuery(sqlQueryForm)"> Save </button>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12 col-12 text-end" *ngIf="viewModel.editMode ">
                                    <button class="btn coinButton" (click)="updateSqlQuery(sqlQueryForm)"> Update
                                        Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <!-- Preview Table  -->




            </div>
            <div class="modal-content" *ngIf="viewModel.preViewTable">
                <div class="modal-header">
                    <div class="col-lg-11 col-md-11 col-sm-11 col-11">
                        <h5>SQL Report </h5>
                    </div>

                    <button type="button" class="btn-close" (click)="closeTablePopUp()"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-12 table-container">
                            <table class="table mb-0 scrollable-table">
                                <thead>
                                    <tr>
                                        <!-- <th *ngFor="let column of viewModel.sqlReportDataModel.reportDataColumns">
                                            {{ column.cellColumnName }}
                                        </th> -->
                                        <th *ngFor="let column of viewModel.sqlReportDataModel.dataColumns">
                                            {{ column.columnName }}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- <tr *ngFor="let row of viewModel.sqlReportDataModel.reportDataRows">
                                        <td *ngFor="let cell of row.reportDataCells">
                                            {{ formatCellValue(cell) }}
                                        </td>
                                    </tr> -->
                                    <tr *ngFor="let row of viewModel.sqlReportDataModel.reportData">
                                        <td *ngFor="let column of viewModel.sqlReportDataModel.dataColumns">
                                            {{ getProperty(row, column.columnName) }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>